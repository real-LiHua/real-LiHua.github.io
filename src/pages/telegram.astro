---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
  <script>
    (async () => {
      try {
        const keyPair = (await window.crypto.subtle.generateKey(
          {
            name: "RSA-OAEP",
            modulusLength: 2048,
            publicExponent: new Uint8Array([1, 0, 1]),
            hash: "SHA-256",
          },
          true,
          ["encrypt", "decrypt"],
        )) as CryptoKeyPair;

        const pubSpki = await window.crypto.subtle.exportKey(
          "jwk",
          keyPair.publicKey,
        );
        const resp = await fetch("https://blog.lihua0.workers.dev/meow", {
          method: "POST",
          body: JSON.stringify(pubSpki),
        });
        const decrypted = await window.crypto.subtle.decrypt(
          { name: "RSA-OAEP" },
          keyPair.privateKey,
          await resp.arrayBuffer(),
        );

        console.log(decrypted);
      } catch (err) {
        console.error(err);
      }
    })();
  </script>
</BaseLayout>
